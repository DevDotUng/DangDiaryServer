<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dangdiary.api.dao.WriteDiaryDAO">
  <insert id="postWriteDiary" parameterType="com.dangdiary.api.dto.writeDiary.DiaryDTO" >
    INSERT INTO diarys
    (user_id, challenge_id, title, place, weather, register_date, feeling, content, image1, image2, image3, image4, image5)
    VALUES
    (#{userId}, #{challengeId}, #{title}, #{place}, #{weather}, NOW(), #{feeling}, #{content}, #{image1}, #{image2}, #{image3}, #{image4}, #{image5})
  </insert>
  <select id="getDiaryId" parameterType="int" resultType="int">
    SELECT diary_id FROM diarys WHERE user_id = #{userId} and challenge_id = #{challengeId} ORDER BY register_date DESC LIMIT 1
  </select>
  <update id="updateUserChallenge" parameterType="int">
    UPDATE user_challenges
    SET diary_bool = 1, diary_id = #{diaryId}
    WHERE user_id = #{userId} and challenge_id = #{challengeId}
  </update>
  <select id="getDiary" parameterType="int" resultType="com.dangdiary.api.dto.writeDiary.DiaryDTO">
    SELECT * FROM diarys WHERE user_id = #{userId} ORDER BY register_date DESC LIMIT 1
  </select>
</mapper>